import{ae as O,x as u,ar as G,ag as z,as as Q,c as l,ai as s,au as W,ac as X,ao as Y,al as F,aM as Z,V as ee,ah as ae,at as le,J as A,aj as t,ak as te,ay as oe,az as se,am as D,aB as re,aE as ue,aw as ne,an as ie,a6 as de}from"./index-2a6e0187.js";import{c as me,a as I,e as ce,f as pe,u as ve,d as c,V as ge}from"./index.esm-ffca95e4.js";import{a as Ve,V as E}from"./VCol-ba6d81c5.js";import{V as fe}from"./VRow-1fd3371c.js";import{V as be}from"./VDivider-303ab244.js";import{V as ye,a as ke,b as xe}from"./VTextarea-6458ace2.js";import{V as we}from"./VDataTable-6273f966.js";import"./VList-581bf7ed.js";const Ce=ie("h1",{class:"text-center"},"商品管理",-1),Ie={__name:"ProductsManagement",setup(he){const{apiAuth:C}=Y(),h=O(),T=u(null),p=u(!1),v=u(""),L=r=>{v.value=r._id,g.value.value=r.name,V.value.value=r.price,f.value.value=r.description,b.value.value=r.category,y.value.value=r.sell,p.value=!0},$=()=>{for(p.value=!1,K();n.value.length>0;)T.value.deleteFileRecord(n.value[0])},q=["營地轉讓","露營裝備"],_=me({name:I().required("缺少商品名稱"),price:ce().typeError("商品價格格式錯誤").required("缺少商品價格").min(0,"商品價格不能小於 0"),description:I().required("缺少商品說明"),category:I().required("缺少商品分類").test("isCategory","商品分類錯誤",r=>q.includes(r)),sell:pe()}),{handleSubmit:j,isSubmitting:B,resetForm:K}=ve({validationSchema:_,initialValues:{name:"",price:0,description:"",category:"",sell:!1}}),g=c("name"),V=c("price"),f=c("description"),b=c("category"),y=c("sell"),n=u([]),N=u([]),H=j(async r=>{var a,d,e;if(!((a=n.value[0])!=null&&a.error)&&!(v.value===""&&n.value.length===0))try{const o=new FormData;for(const i in r)o.append(i,r[i]);if(n.value.length>0)for(const i of n.value)o.append("image",i.file);v.value===""?await C.post("/products",o):await C.patch("/products/"+v.value,o),h({text:"編輯成功",showCloseButton:!1,snackbarProps:{timeout:2e3,color:"green",location:"bottom"}}),$(),U()}catch(o){console.log(o);const i=((e=(d=o==null?void 0:o.response)==null?void 0:d.data)==null?void 0:e.message)||"發生錯誤，請稍後再試";h({text:i,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom"}})}}),M=u(10),k=u([{key:"createdAt",order:"desc"}]),x=u(1),P=u([]),J=[{title:"圖片",align:"center",sortable:!1,key:"image"},{title:"名稱",align:"center",sortable:!0,key:"name"},{title:"價格",align:"center",sortable:!0,key:"price"},{title:"分類",align:"center",sortable:!0,key:"category"},{title:"上架",align:"center",sortable:!0,key:"sell"},{title:"編輯",align:"center",sortable:!1,key:"edit"}],S=u(!0),R=u(0),w=u(""),m=async()=>{var r,a,d,e;S.value=!0;try{const{data:o}=await C.get("/products",{params:{page:x.value,itemsPerPage:M.value,sortBy:((r=k.value[0])==null?void 0:r.key)||"createdAt",sortOrder:((a=k.value[0])==null?void 0:a.order)==="asc"?1:-1,search:w.value}});P.value.splice(0,P.value.length,...o.result.data),R.value=o.result.total}catch(o){console.log(o);const i=((e=(d=o==null?void 0:o.response)==null?void 0:d.data)==null?void 0:e.message)||"發生錯誤，請稍後再試";h({text:i,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom"}})}S.value=!1};m();const U=()=>{x.value=1,m()};return(r,a)=>{const d=G("VueFileAgent");return z(),Q(X,null,[l(Ve,null,{default:s(()=>[l(fe,null,{default:s(()=>[l(E,{cols:"12"},{default:s(()=>[Ce]),_:1}),l(be),l(E,{cols:"12"},{default:s(()=>[l(ye,{"items-per-page":M.value,"onUpdate:itemsPerPage":[a[1]||(a[1]=e=>M.value=e),m],"sort-by":k.value,"onUpdate:sortBy":[a[2]||(a[2]=e=>k.value=e),m],page:x.value,"onUpdate:page":[a[3]||(a[3]=e=>x.value=e),m],items:P.value,headers:J,loading:S.value,"items-length":R.value,search:w.value,hover:""},{top:s(()=>[l(F,{label:"搜尋","append-icon":"mdi-magnify",modelValue:w.value,"onUpdate:modelValue":a[0]||(a[0]=e=>w.value=e),"onClick:append":U,onKeydown:Z(U,["enter"])},null,8,["modelValue"])]),"item.image":s(({item:e})=>[l(ee,{src:e.image[0],height:"50px"},null,8,["src"])]),"item.sell":s(({item:e})=>[e.sell?(z(),ae(de,{key:0,icon:"mdi-check"})):le("",!0)]),"item.edit":s(({item:e})=>[l(A,{icon:"mdi-pencil",variant:"text",color:"blue",onClick:o=>L(e)},null,8,["onClick"])]),_:2},1032,["items-per-page","sort-by","page","items","loading","items-length","search"])]),_:1})]),_:1})]),_:1}),l(W,{modelValue:p.value,"onUpdate:modelValue":a[11]||(a[11]=e=>p.value=e),persistent:"",width:"500px"},{default:s(()=>[l(ge,{disabled:t(B),onSubmit:te(t(H),["prevent"])},{default:s(()=>[l(oe,null,{default:s(()=>[l(se,null,{default:s(()=>[D("編輯商品")]),_:1}),l(re,null,{default:s(()=>[l(F,{label:"名稱",modelValue:t(g).value.value,"onUpdate:modelValue":a[4]||(a[4]=e=>t(g).value.value=e),"error-messages":t(g).errorMessage.value},null,8,["modelValue","error-messages"]),l(F,{label:"價格",type:"number",min:"0",modelValue:t(V).value.value,"onUpdate:modelValue":a[5]||(a[5]=e=>t(V).value.value=e),"error-messages":t(V).errorMessage.value},null,8,["modelValue","error-messages"]),l(we,{label:"分類",items:q,modelValue:t(b).value.value,"onUpdate:modelValue":a[6]||(a[6]=e=>t(b).value.value=e),"error-messages":t(b).errorMessage.value},null,8,["modelValue","error-messages"]),l(ke,{label:"上架",modelValue:t(y).value.value,"onUpdate:modelValue":a[7]||(a[7]=e=>t(y).value.value=e),"error-messages":t(y).errorMessage.value},null,8,["modelValue","error-messages"]),l(xe,{label:"說明",modelValue:t(f).value.value,"onUpdate:modelValue":a[8]||(a[8]=e=>t(f).value.value=e),"error-messages":t(f).errorMessage.value},null,8,["modelValue","error-messages"]),l(d,{modelValue:n.value,"onUpdate:modelValue":a[9]||(a[9]=e=>n.value=e),rawModelValue:N.value,"onUpdate:rawModelValue":a[10]||(a[10]=e=>N.value=e),accept:"image/jpeg,image/png",deletable:"","error-text":{type:"檔案格式不支援",size:"檔案超過 1MB 大小限制"},"help-text":"選擇檔案或拖曳到這裡","max-files":5,multiple:"","max-size":"1MB",ref_key:"fileAgent",ref:T},null,8,["modelValue","rawModelValue"])]),_:1}),l(ue,null,{default:s(()=>[l(ne),l(A,{color:"red",disabled:t(B),onClick:$},{default:s(()=>[D("取消")]),_:1},8,["disabled"]),l(A,{color:"green",type:"submit",loading:t(B)},{default:s(()=>[D("送出")]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["disabled","onSubmit"])]),_:1},8,["modelValue"])],64)}}};export{Ie as default};
