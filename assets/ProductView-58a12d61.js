import{aF as S,ad as k,ae as B,af as C,x as q,A as P,ag as A,as as F,c as a,ai as s,aG as $,ac as E,ao as M,an as r,ax as u,V as N,aj as i,ak as R,J as f,am as h}from"./index-2a6e0187.js";import{c as j,e as D,u as G,V as I}from"./index.esm-ffca95e4.js";import{a as J,V as d}from"./VCol-ba6d81c5.js";import{V as L}from"./VRow-1fd3371c.js";const O=r("p",null,"價格",-1),T={class:"mb-4"},U=r("p",null,"說明",-1),W={class:"mb-4",style:{"white-space":"pre"}},z=r("h1",{class:"text-red text-h1"},"已下架",-1),Z={__name:"ProductView",setup(H){const g=S(),m=k(),{api:v,apiAuth:b}=M(),c=B(),p=C(),t=q({_id:"",name:"",price:0,description:"",image:"",sell:!0,category:""}),y=j({quantity:D().typeError("缺少數量").required("缺少數量").max(1,"數量最大為 1")}),{isSubmitting:_,handleSubmit:V}=G({validationSchema:y,initialValues:{quantity:1}}),x=V(async n=>{var l,e;if(!p.isLogin){m.push("/login");return}try{const{data:o}=await b.patch("/users/cart",{product:t.value._id,quantity:n.quantity});p.cart=o.result,c({text:"成功加入購物車",showCloseButton:!1,snackbarProps:{timeout:2e3,color:"green",location:"bottom"}})}catch(o){const w=((e=(l=o==null?void 0:o.response)==null?void 0:l.data)==null?void 0:e.message)||"發生錯誤，請稍後再試";c({text:w,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom"}})}});return P(async()=>{var n,l;try{const{data:e}=await v.get("/products/"+g.params.id);t.value._id=e.result._id,t.value.name=e.result.name,t.value.price=e.result.price,t.value.description=e.result.description,t.value.image=e.result.image,t.value.sell=e.result.sell,t.value.category=e.result.category,document.title=`WE CAMP | ${t.value.name}`}catch(e){console.log(e);const o=((l=(n=e==null?void 0:e.response)==null?void 0:n.data)==null?void 0:l.message)||"發生錯誤，請稍後再試";c({text:o,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom"}}),m.push("/")}}),(n,l)=>(A(),F(E,null,[a(J,null,{default:s(()=>[a(L,null,{default:s(()=>[a(d,{cols:"12"},{default:s(()=>[r("h1",null,u(t.value.name),1)]),_:1}),a(d,{cols:"12",md:"6"},{default:s(()=>[a(N,{src:t.value.image[0]},null,8,["src"])]),_:1}),a(d,{cols:"12",md:"6"},{default:s(()=>[O,r("p",T,"$"+u(t.value.price),1),U,r("p",W,u(t.value.description),1),a(I,{disabled:i(_),onSubmit:R(i(x),["prevent"])},{default:s(()=>[a(f,{type:"submit","prepend-icon":"mdi-cart",loading:i(_)},{default:s(()=>[h("加入購物車")]),_:1},8,["loading"])]),_:1},8,["disabled","onSubmit"])]),_:1})]),_:1})]),_:1}),a($,{class:"align-center justify-center text-center","model-value":!t.value.sell,persistent:""},{default:s(()=>[z,a(f,{to:"/",color:"green"},{default:s(()=>[h("回首頁")]),_:1})]),_:1},8,["model-value"])],64))}};export{Z as default};
