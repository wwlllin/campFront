import{ae as S,af as A,ad as D,x as _,o as k,A as N,ag as h,ah as M,ai as s,ao as T,c as n,as as v,ax as i,am as x,J as g,an as b}from"./index-2a6e0187.js";import{a as E,V as y}from"./VCol-ba6d81c5.js";import{V as I}from"./VDivider-303ab244.js";import{a as J}from"./VDataTable-6273f966.js";import"./VList-581bf7ed.js";const L=b("h1",null,"購物車",-1),R={key:0},U={key:1,class:"text-red text-decoration-line-through"},K={__name:"MyCart",setup($){const{apiAuth:d}=T(),r=S(),p=A(),f=D(),o=_([]),C=[{title:"商品名稱",key:"product.name"},{title:"單價",key:"product.price"},{title:"數量",key:"quantity"},{title:"總價",key:"total",value:e=>e.product.price*e.quantity},{title:"刪除",key:"action"}],B=k(()=>o.value.reduce((e,a)=>e+a.quantity*a.product.price,0)),V=k(()=>o.value.length>0&&!o.value.some(e=>!e.product.sell)),w=async(e,a)=>{var t,c;if(!p.isLogin){f.push("/login");return}try{const{data:l}=await d.patch("/users/cart",{product:e,quantity:a});p.cart=l.result,r({text:"修改成功",showCloseButton:!1,snackbarProps:{timeout:2e3,color:"green",location:"bottom"}});const u=o.value.findIndex(P=>P.product._id===e);o.value[u].quantity+=a,o.value[u].quantity<=0&&o.value.splice(u,1)}catch(l){const u=((c=(t=l==null?void 0:l.response)==null?void 0:t.data)==null?void 0:c.message)||"發生錯誤，請稍後再試";r({text:u,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom"}})}},m=_(!1),q=async()=>{var e,a;m.value=!0;try{await d.post("/myorders"),p.cart=0,f.push("/myorders"),r({text:"結帳成功",showCloseButton:!1,snackbarProps:{timeout:2e3,color:"green",location:"bottom"}})}catch(t){const c=((a=(e=t==null?void 0:t.response)==null?void 0:e.data)==null?void 0:a.message)||"發生錯誤，請稍後再試";r({text:c,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom"}})}m.value=!1};return N(async()=>{var e,a;try{const{data:t}=await d.get("/users/cart");o.value.push(...t.result)}catch(t){const c=((a=(e=t==null?void 0:t.response)==null?void 0:e.data)==null?void 0:a.message)||"發生錯誤，請稍後再試";r({text:c,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom"}})}}),(e,a)=>(h(),M(E,null,{default:s(()=>[n(y,{cols:"12"},{default:s(()=>[L]),_:1}),n(I),n(y,{cols:"12"},{default:s(()=>[n(J,{items:o.value,headers:C},{"item.product.name":s(({item:t})=>[t.product.sell?(h(),v("span",R,i(t.product.name),1)):(h(),v("span",U,i(t.product.name)+" (已下架)",1))]),"item.quantity":s(({item:t})=>[x(i(t.quantity),1)]),"item.action":s(({item:t})=>[n(g,{variant:"text",icon:"mdi-delete",color:"red",onClick:c=>w(t.product._id,t.quantity*-1)},null,8,["onClick"])]),_:2},1032,["items"])]),_:1}),n(y,{class:"text-center",cols:"12"},{default:s(()=>[b("p",null,"總金額: "+i(B.value),1),n(g,{color:"green",disabled:!V.value,loading:m.value,onClick:q},{default:s(()=>[x("結帳")]),_:1},8,["disabled","loading"])]),_:1})]),_:1}))}};export{K as default};
